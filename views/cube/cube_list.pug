extends cube_layout

block cube_toolbar
  link(rel='stylesheet' href='/css/tags.css')
  link(rel='stylesheet' href='/css/editcube.css')
  link(rel='stylesheet' href='/css/texteditor.css')

  input#cubeID(type='hidden', name='cubeID', value=cube_id)
  input#cuberaw(type='hidden', name='cuberaw', value=cube_raw)
  input#canEdit(type='hidden', name='canEdit', value=(user && user.id == cube.owner).toString())
  input#cubeTagColors(type='hidden', name='cubeTagColors', value=JSON.stringify(cube.tag_colors))
  input#hideTagColors(type='hidden', name='hideTagColors', value=(!!user && user.hide_tag_colors === true).toString())
  if user && user.id == cube.owner
    input#edittoken(type='hidden', name='edittoken', value='edit')
  if cube.default_sorts
    input#sort1(type='hidden', value=cube.default_sorts[0])
    input#sort2(type='hidden', value=cube.default_sorts[1])

block cube_content
  .container#cubelistarea
  #react-root

  // Filter Modal
  #filterModal.modal.fade(tabindex='-1', role='dialog')
    .modal-dialog.modal-dialog-centered.modal-lg(role='document')
      .modal-content
        .modal-header
          h5.modal-title Advanced Filter
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        .modal-body
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text Card Name
            input#filterName.form-control(type='text', placeholder='Any words in the name, e.g. "Fire"')       
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text Oracle Text
            input#filterOracle.form-control(type='text', placeholder='Any text, e.g. "Draw a card"')        
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text CMC
            select.custom-select#filterCMCOp
              option(value='=' selected='') equal to
              option(value='<') less than
              option(value='>') greater than
              option(value='<=') less than or equal to
              option(value='>=') greater than or equal to
              option(value='!') not equal to
            input#filterCMC.form-control(type='text', placeholder='Any value, e.g. "2"')   
          hr
          h6.span Color: 
            .form-check.form-check-inline
              input#filterColorW.form-check-input(type='checkbox', value='option1')
              label.form-check-label(for='groupContextModalCheckboxW')
                img(src='/content/symbols/w.png' alt='White' title='White')
            .form-check.form-check-inline
              input#filterColorU.form-check-input(type='checkbox', value='option2')
              label.form-check-label(for='groupContextModalCheckboxU')
                img(src='/content/symbols/u.png' alt='Blue' title='Blue')
            .form-check.form-check-inline
              input#filterColorB.form-check-input(type='checkbox', value='option3')
              label.form-check-label(for='groupContextModalCheckboxB')
                img(src='/content/symbols/b.png' alt='Black' title='Black')
            .form-check.form-check-inline
              input#filterColorR.form-check-input(type='checkbox', value='option4')
              label.form-check-label(for='groupContextModalCheckboxR')
                img(src='/content/symbols/r.png' alt='Red' title='Red')
            .form-check.form-check-inline
              input#filterColorG.form-check-input(type='checkbox', value='option5')
              label.form-check-label(for='groupContextModalCheckboxG')
                img(src='/content/symbols/g.png' alt='Green' title='Green')
            .form-check.form-check-inline
              input#filterColorC.form-check-input(type='checkbox', value='option6')
              label.form-check-label(for='groupContextModalCheckboxC')
                img(src='/content/symbols/c.png' alt='Colorless' title='Colorless')
          select.custom-select#filterColorOp
            option(value='=' selected='') Exactly these colors
            option(value='>=') Including these colors
            option(value='<=') At most these colors
          hr
          h6.span Color Identity: 
            .form-check.form-check-inline
              input#filterColorIdentityW.form-check-input(type='checkbox', value='option1')
              label.form-check-label(for='groupContextModalCheckboxW')
                img(src='/content/symbols/w.png' alt='White' title='White')
            .form-check.form-check-inline
              input#filterColorIdentityU.form-check-input(type='checkbox', value='option2')
              label.form-check-label(for='groupContextModalCheckboxU')
                img(src='/content/symbols/u.png' alt='Blue' title='Blue')
            .form-check.form-check-inline
              input#filterColorIdentityB.form-check-input(type='checkbox', value='option3')
              label.form-check-label(for='groupContextModalCheckboxB')
                img(src='/content/symbols/b.png' alt='Black' title='Black')
            .form-check.form-check-inline
              input#filterColorIdentityR.form-check-input(type='checkbox', value='option4')
              label.form-check-label(for='groupContextModalCheckboxR')
                img(src='/content/symbols/r.png' alt='Red' title='Red')
            .form-check.form-check-inline
              input#filterColorIdentityG.form-check-input(type='checkbox', value='option5')
              label.form-check-label(for='groupContextModalCheckboxG')
                img(src='/content/symbols/g.png' alt='Green' title='Green')
            .form-check.form-check-inline
              input#filterColorIdentityC.form-check-input(type='checkbox', value='option6')
              label.form-check-label(for='groupContextModalCheckboxC')
                img(src='/content/symbols/c.png' alt='Colorless' title='Colorless')
          select.custom-select#filterColorIdentityOp
            option(value='=' selected='') Exactly these colors
            option(value='>=') Including these colors
            option(value='<=') At most these colors
          hr 
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text Mana Cost
            input#filterMana.form-control(type='text', placeholder='Any mana cost, e.g. "{1}{W}"')
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text Type Line
            input#filterType.form-control(type='text', placeholder='Choose any card type, supertype, or subtypes to match')
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text Tag
            input#filterTag.form-control(type='text', placeholder='Any text, e.g. "Zombie Testing"')            
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text Status
            select.custom-select#filterStatus
              option(selected='')
              option(value='Not Owned') Not Owned
              option(value='Ordered') Ordered
              option(value='Owned') Owned
              option(value='Premium Owned') Premium Owned
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text Price
            select.custom-select#filterPriceOp
              option(value='=' selected='') equal to
              option(value='<') less than
              option(value='>') greater than
              option(value='<=') less than or equal to
              option(value='>=') greater than or equal to
            input#filterPrice.form-control(type='text', placeholder='Any decimal number, e.g. "3.50"')        
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text Foil Price
            select.custom-select#filterPriceFoilOp
              option(value='=' selected='') equal to
              option(value='<') less than
              option(value='>') greater than
              option(value='<=') less than or equal to
              option(value='>=') greater than or equal to
            input#filterPriceFoil.form-control(type='text', placeholder='Any decimal number, e.g. "3.50"')  
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text Power
            select.custom-select#filterPowerOp
              option(value='=' selected='') equal to
              option(value='<') less than
              option(value='>') greater than
              option(value='<=') less than or equal to
              option(value='>=') greater than or equal to
              option(value='!') not equal to
            input#filterPower.form-control(type='text', placeholder='Any value, e.g. "2"')   
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text Toughness
            select.custom-select#filterToughnessOp
              option(value='=' selected='') equal to
              option(value='<') less than
              option(value='>') greater than
              option(value='<=') less than or equal to
              option(value='>=') greater than or equal to
              option(value='!') not equal to
            input#filterToughness.form-control(type='text', placeholder='Any value, e.g. "2"')
          .input-group.mb-3
            .input-group-prepend
              span.input-group-text Rarity
            select.custom-select#filterRarityOp
              option(value='=' selected='') equal to
              option(value='<') less than
              option(value='>') greater than
              option(value='<=') less than or equal to
              option(value='>=') greater than or equal to
            input#filterRarity.form-control(type='text', placeholder='Any rarity, e.g. "common"')
        .modal-footer
          button.btn.btn-danger(type='button', data-dismiss='modal', aria-label='Close') Cancel
          button.btn.btn-success#applyAdvancedFilterButton(type='button') Apply

  //group context modal
  if user && user.id == cube.owner
    #groupContextModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='exampleModalCenterTitle', aria-hidden='true')
      .modal-dialog.modal-dialog-centered.modal-lg(role='document')
        .modal-content
          .modal-header
            h5.modal-title Edit Selected
            button.close(type='button', data-dismiss='modal', aria-label='Close')
              span(aria-hidden='true') ×
          .row.no-gutters
            .col-4#groupContextModalAreaContainer(style='padding: 4px;')
              #groupContextModalArea
              .price-area
            .col-8
              .modal-body
                .controls
                  h5 Set Status of All
                  .input-group.mb-3
                    .input-group-prepend
                      span.input-group-text Status
                    select#groupContextModalStatusSelect.custom-select(aria-label='Example select with button addon')
                      option(selected='')
                      option(value='Not Owned') Not Owned
                      option(value='Ordered') Ordered
                      option(value='Owned') Owned
                      option(value='Premium Owned') Premium Owned
                  h5 Override Attribute on All
                  .input-group.mb-3
                    .input-group-prepend
                      span.input-group-text CMC
                    input#groupContextModalCMC.form-control(type='text', value='2')
                  .input-group.mb-3
                    .input-group-prepend
                      span.input-group-text Type
                    input#groupContextModalType.form-control(type='text', value='2')
                  h5 Color Identity Override:
                  .form-check.form-check-inline
                    input#groupContextModalCheckboxW.form-check-input(type='checkbox', value='option1')
                    label.form-check-label(for='groupContextModalCheckboxW')
                      img(src='/content/symbols/w.png' alt='White' title='White')
                  .form-check.form-check-inline
                    input#groupContextModalCheckboxU.form-check-input(type='checkbox', value='option2')
                    label.form-check-label(for='groupContextModalCheckboxU')
                      img(src='/content/symbols/u.png' alt='Blue' title='Blue')
                  .form-check.form-check-inline
                    input#groupContextModalCheckboxB.form-check-input(type='checkbox', value='option3')
                    label.form-check-label(for='groupContextModalCheckboxB')
                      img(src='/content/symbols/b.png' alt='Black' title='Black')
                  .form-check.form-check-inline
                    input#groupContextModalCheckboxR.form-check-input(type='checkbox', value='option4')
                    label.form-check-label(for='groupContextModalCheckboxR')
                      img(src='/content/symbols/r.png' alt='Red' title='Red')
                  .form-check.form-check-inline
                    input#groupContextModalCheckboxG.form-check-input(type='checkbox', value='option5')
                    label.form-check-label(for='groupContextModalCheckboxG')
                      img(src='/content/symbols/g.png' alt='Green' title='Green')
                  .form-check.form-check-inline
                    input#groupContextModalCheckboxC.form-check-input(type='checkbox', value='option6')
                    label.form-check-label(for='groupContextModalCheckboxC')
                      img(src='/content/symbols/c.png' alt='Colorless' title='Colorless')
                  br
                  em Selecting no mana symbols will cause the selected cards' color identity to remain unchanged. Selecting only colorless will cause the selected cards' color identity to be set to colorless.
                  br
                  br
                  h5 Edit Tags
                  .form-check
                    input#groupContextAdd.form-check-input(type='radio', name='nameType', value='~', checked='')
                    label.form-check-label(for='groupContextAdd') Add tags to All
                  .form-check
                    input#groupContextRemove.form-check-input(type='radio', name='nameType', value='=')
                    label.form-check-label(for='groupContextRemove') Remove tags from All
                  br
                  .tags-area#groupContextTags
                    .tags-input(data-name='tags-input')
                      span.tags
                      input.hidden-input(type='hidden')
                      input.main-input(maxlength="24")
                br
                br
                p
                  em TCGplayer currently does not support mass entry while preserving card versions, be sure to verify any card versions after using 'Buy all'.

          .modal-footer
            button#groupContextRemoveButton.btn.btn-danger(type='button') Remove all from cube
            form#groupContextBuyForm(method='POST', action='#', target="_blank")
              input#groupContextBuyHidden.form-control.col-sm-9(name='c', type='hidden')
              input.btn.btn-secondary(type='submit',value='Buy all')
            button#groupContextModalSubmit.btn.btn-success(type='button') Apply to all

  // Modal
  #tagColorsModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='exampleModalCenterTitle', aria-hidden='true')
    .modal-dialog.modal-dialog-centered.modal-lg(role='document')
      .modal-content
        .modal-header
          h5#tagColorsTitle.modal-title
            if user && user.id == cube.owner
              | Set Tag Colors
            else
              | View Tag Colors
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        #showTagColors
          .form-check.form-check-inline
            input#showTagColorsCheckbox.form-check-input(type='checkbox')
            label.form-check-label(for='showTagColorsCheckbox') Show Tag Colors in Card List 
          if user && user.id == cube.owner
            div
              span(style="font-style: italic;") (Drag the tags below into a priority order to use for cards that have more than one tag)
        #tagsColumn.col

        .modal-footer
          button#tagColorsCancel.btn.btn-danger(type='button', data-dismiss='modal', aria-label='Close')
            if user && user.id == cube.owner
              | Cancel
            else
              | Close
          if user && user.id == cube.owner
            button#tagColorsSubmit.btn.btn-success(type='button') Save

  // Modal
  #contextModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='exampleModalCenterTitle', aria-hidden='true')
    .modal-dialog.modal-dialog-centered.modal-lg(role='document')
      .modal-content
        .modal-header
          h5#contextModalTitle.modal-title Ambush Viper
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        .row.no-gutters
          .col-12.col-sm-4(style='padding: 4px;')
            img#contextModalImg.card-img.defaultCardImage(src="https://img.scryfall.com/cards/normal/front/0/c/0c082aa8-bf7f-47f2-baf8-43ad253fd7d7.jpg?1545408427", alt='...')
            .price-area
          .col-12.col-sm-8
            .modal-body
              fieldset(disabled=!user || user.id != cube.owner)
                h5 Card Attributes
                .input-group.mb-3
                  .input-group-prepend
                    span.input-group-text Version (Set and #)
                  select#contextModalVersionSelect.custom-select
                .input-group.mb-3
                  .input-group-prepend
                    span.input-group-text Status
                  select#contextModalStatusSelect.custom-select
                .input-group.mb-3
                  .input-group-prepend
                    span.input-group-text CMC
                  input#contextModalCMC.form-control(type='text', value='2')
                .input-group.mb-3
                  .input-group-prepend
                    span.input-group-text Type
                  input#contextModalType.form-control(type='text', value='2')
                .input-group.mb-3
                  .input-group-prepend
                    span.input-group-text Card Image URL
                  input#contextModalImageURL.form-control(type='text', value='2')
                h5 Color Identity Override:
                .form-check.form-check-inline
                  input#contextModalCheckboxW.form-check-input(type='checkbox', value='option1')
                  label.form-check-label(for='contextModalCheckboxW')
                    img(src='/content/symbols/w.png' alt='White' title='White')
                .form-check.form-check-inline
                  input#contextModalCheckboxU.form-check-input(type='checkbox', value='option2')
                  label.form-check-label(for='contextModalCheckboxU')
                    img(src='/content/symbols/u.png' alt='Blue' title='Blue')
                .form-check.form-check-inline
                  input#contextModalCheckboxB.form-check-input(type='checkbox', value='option3')
                  label.form-check-label(for='contextModalCheckboxB')
                    img(src='/content/symbols/b.png' alt='Black' title='Black')
                .form-check.form-check-inline
                  input#contextModalCheckboxR.form-check-input(type='checkbox', value='option4')
                  label.form-check-label(for='contextModalCheckboxR')
                    img(src='/content/symbols/r.png' alt='Red' title='Red')
                .form-check.form-check-inline
                  input#contextModalCheckboxG.form-check-input(type='checkbox', value='option5')
                  label.form-check-label(for='contextModalCheckboxG')
                    img(src='/content/symbols/g.png' alt='Green' title='Green')
                h5 Tags
                .tags-area#contextTags
                  .tags-input(data-name='tags-input')
                    span.tags
                    input.hidden-input(type='hidden')
                    input.main-input(maxlength="24")

        .modal-footer
          if user && user.id == cube.owner
            button#contextRemoveButton.btn.btn-danger(type='button')
              span.d-none.d-sm-inline Remove from cube
              span.d-sm-none Remove
          a#contextScryfallButton(href="#", target="_blank")
            button.btn.btn-secondary(type='button')
              span.d-none.d-sm-inline View on Scryfall
              span.d-sm-none Scryfall
          a#contextBuyButton(href="#", target="_blank")
            button.btn.btn-secondary(type='button') Buy
          if user && user.id == cube.owner
            button#contextModalSubmit.btn.btn-success(type='button') Save

  // Paste bulk Modal
  #pasteBulkModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='pasteBulkModalTitle', aria-hidden='true')
    .modal-dialog.modal-dialog-scrollable(role='document')
      .modal-content
        form(method='POST', action='/cube/bulkupload/'+cube_id)
          .modal-header
            h5#pasteBulkModalTitle.modal-title Bulk Upload - Paste Text
            button.close(type='button', data-dismiss='modal', aria-label='Close')
              span(aria-hidden='true') ×
          .modal-body
            p Acceptable plain text with one card name per line.
            textarea.form-control(maxlength='20000',rows='10', style='height:100%;', placeholder="Paste Cube Here (max length 20000)", name='body')
          .modal-footer
            #bulkspinner.collapse.spinner-border.text-success(role='status')
              span.sr-only Loading...
            button.btn.btn-success(type='submit', data-toggle='collapse', href='#bulkspinner') Upload
            button.btn.btn-secondary(type='button', data-dismiss='modal') Close

  // file upload
  #uploadBulkModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='uploadBulkModalTitle', aria-hidden='true')
    .modal-dialog.modal-dialog-scrollable(role='document')
      .modal-content
        .modal-header
          h5#uploadBulkModalTitle.modal-title Bulk Upload - Upload File
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        .modal-body
          p Acceptable files are either .txt (plaintext) with one card name per line, or .csv with the exact format as our .csv export.
          form#uploadFileForm.custom-file(ref='uploadForm', action='/cube/bulkuploadfile/'+cube_id, method='post', enctype='multipart/form-data')
            input#customFile.custom-file-input(style='padding:10px' type='file' name='document' onchange="$('#upload-file-info').html(this.files[0].name)")
            label#upload-file-info.custom-file-label(for='customFile') Choose file
        .modal-footer
          button.btn.btn-success(type='submit' form='uploadFileForm') Upload
          button.btn.btn-secondary(type='button', data-dismiss='modal') Close

  // cubetutor import
  #importModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='importModalTitle', aria-hidden='true')
    .modal-dialog.modal-dialog-scrollable(role='document')
      .modal-content
        .modal-header
          h5#importModalModalTitle.modal-title Bulk Upload - Import from Cubetutor
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        .modal-body
          p Most card versions will be mantained. Some cards with unknown sets will default to the newest printing. Tags will not be imported. Cubetutor does not recognize alternate versions
            |  of cards with the same name, in the same set (e.g. Hymn to Tourach alternate arts, Basic Lands, Everythingamajig). These cards should be checked to ensure the desired version
            |  has been added.
          .input-group.mb-3
            .input-group-prepend
              span#basic-addon3.input-group-text Cube ID  (enter cube id from URL):
            form#importForm.custom-file(ref='uploadForm', action='/cube/importcubetutor/'+cube_id, method='post', enctype='multipart/form-data')
              input.form-control(type='text', name='cubeid', placeholder='e.g. 123456')

        .modal-footer
          button.btn.btn-success(type='submit' form='importForm') Import
          button.btn.btn-secondary(type='button', data-dismiss='modal') Close
  // cubetutor import
  #selectEmptyModal.modal.fade(tabindex='-1', role='dialog')
    .modal-dialog.modal-dialog-scrollable(role='document')
      .modal-content
        .modal-header
          h5.modal-title Cannot Edit Selected
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        .modal-body
          p No cards are selected. To select and edit multiple cards, use the 'List View' and check the desired cards.

        .modal-footer
          button.btn.btn-secondary(type='button', data-dismiss='modal') Close

  #cubeSaveModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='cubeSaveModalTitle', aria-hidden='true')
    .modal-dialog.modal-dialog-scrollable(role='document')
      .modal-content
        .modal-header
          h5#cubeSaveModalTitle.modal-title Success
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        .modal-body
          p Default sorts saved successfully
        .modal-footer
          button.btn.btn-secondary(type='button', data-dismiss='modal') OK

  script(src='/js/utils.js')
  script(src='/js/autocard.js')
  script(src='/js/autocomplete.js')
  script(src='/js/sortfilter.js')
  script(src='/js/tags.js')
  script(src='/js/editcube.js')
  script(src='/js/cube_list.bundle.js')
